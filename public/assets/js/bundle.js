class App{constructor(){this.index=0,this.currentSelection=null,this.selections=this.getSelections(),this.renderSelections(this.selections),this.hitPos={top:0,left:0},this.$plan=$("#plan"),this.resetSelection();const e=this;this.$plan.mousedown(t=>{t.preventDefault(),e.$plan.mousemove(e._moveSelection.bind(e)),e.$plan.mouseup(e._endSelection.bind(e)),e.$plan.mouseleave(e._endSelection.bind(e)),e._startSelection(t)}),$("#plan-file").change(e=>{if(e.target.files&&e.target.files.length>0){const t=new FileReader;t.onload=(e=>$("#plan-img").attr("src",e.target.result)),t.readAsDataURL(e.target.files[0])}})}saveSelection(e,t){this.selections[e]=t,localStorage.setItem(e,JSON.stringify(t))}removeSelection(e){delete this.selections[e],localStorage.removeItem(e)}getSelections(){for(var e={},t=0;t<localStorage.length;++t){const i=JSON.parse(localStorage.getItem(localStorage.key(t)));e[localStorage.key(t)]=i}return e}renderSelections(e){const t=$("#plan");for(var i in e){const s=e[i];t.append(this.getSelectionDiv(i,!1)),$(`#selection_${i}`).css({top:s.top,left:s.left,width:`${s.width}px`,height:`${s.height}px`})}this.attachCloseListenersToSelections(e)}attachCloseListenersToSelections(e){for(var t in e){const e=this;$(`#selection_close_${t}`).click(function(t){return i=>{i.preventDefault();const s=$(`#selection_${t}`);e.removeSelection(t),s.remove()}}(t))}}resetSelection(){this.$currentSelection&&this.$currentSelection.css({top:0,left:0,width:0,height:0})}getSelectionDiv(e,t=!0){const i=t?"none":"block";return $(`<div id='selection_${e}' class='select-box'><div id='selection_close_${e}' class='select-close-button' style='display: ${i}'>x</div></div>`)}_addSelection(){const e=$("#plan"),t=++this.index,i=this.getSelectionDiv(t);e.append(i),this.$currentSelection=i}_startSelection(e){const t=e.offsetX,i=e.offsetY;this._addSelection(),this.hitPos.left=t,this.hitPos.top=i,this.$currentSelection.css({left:t,top:i})}_moveSelection(e){console.log(e.offsetX);const t=-(this.hitPos.left-e.offsetX),i=-(this.hitPos.top-e.offsetY);this.$currentSelection.css({width:t,height:i})}_endSelection(e){const t=`selection_close_${this.index}`,i=this;if(this.$currentSelection.width()<10||this.$currentSelection.height()<10)this.$currentSelection.remove();else{$(`#${t}`).show(),$(`#${t}`).click(function(e){return t=>{t.preventDefault();const s=$(`#selection_${e}`);i.removeSelection(e),s.remove()}}(this.index));var s={top:this.$currentSelection.position().top,left:this.$currentSelection.position().left,width:this.$currentSelection.width(),height:this.$currentSelection.height()};this.saveSelection(this.index,s),this.$plan.unbind("mousemove"),this.$plan.unbind("mouseup"),this.$plan.unbind("mouseleave")}}}const app=new App;
//# sourceMappingURL=bundle.js.map
